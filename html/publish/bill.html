<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"/>

    <title>派单</title>
    <link rel="stylesheet" href="../../css/mui.min.css"/>
    <link rel="stylesheet" href="../../css/base.css"/>
    <link rel="stylesheet" href="../../css/header.css"/>
    <link rel="stylesheet" href="../../css/sweetalert2.css"/>
    <link rel="stylesheet" href="../../css/data/index_1.css"/>
    <link rel="stylesheet" href="../../css/publish/bill.css"/>
    <script src="../../js/common/mui.min.js"></script>
    <!--<script src="../../js/common/zepto.min.js"></script>
    <script src="../../js/common/selector.js"></script>
    <script src="../../js/common/touch.js"></script>-->
    <script src="../../js/common/base.js"></script>
    <script src="../../js/common/back.js"></script>
    <script src="../../js/common/fastclick.js"></script>
    <script src="../../js/data/jquery-1.10.2_1.js"></script>
    <script src="../../js/data/flexible.debug_1.js"></script>
    <script src="../../js/data/flexible_css.debug_1.js"></script>
    <script src="../../js/data/mobilefix_1.js"></script>
    <script src="../../js/data/swiper.min_1.js"></script>
    <script src="../../js/data/kinerdatepicker_1.js"></script>
    <script src="../../js/common/sweetalert2.js"></script>
    <script src="../../js/common/x_rem.js"></script>
</head>
<body>
<div class="layer">
    <header>
        <i onclick="back()"></i>
        <h3>填写发单内容</h3>
    </header>
    <div class="main">
        <div class="work_type">
            <span>岗位类型</span>
            <a href="#middlePopover">请选择 <i class="mui-icon mui-icon-arrowdown"></i> </a>
            <div id="middlePopover" class="mui-popover">
                <div class="mui-card">
                    <ul class="mui-table-view mui-table-view-radio work_style">
                        <li class="mui-table-view-cell">
                            <a class="mui-navigate-right">
                                打扫卫生
                            </a>
                        </li>
                        <li class="mui-table-view-cell">
                            <a class="mui-navigate-right">
                                洗衣服
                            </a>
                        </li>
                        <li class="mui-table-view-cell">
                            <a class="mui-navigate-right">
                                导游
                            </a>
                        </li>
                        <li class="mui-table-view-cell">
                            <a class="mui-navigate-right">
                                做饭
                            </a>
                        </li>
                    </ul>
                </div>

            </div>
        </div>
        <div class="need">
            <span>需求人数</span>
            <input type="number" placeholder="请输入您需要的人数"/>
        </div>
        <div class="time">
            <span>工作时段</span>
            <input type="text" placeholder="请输入工作时段"/>
        </div>
        <!--开始时间-->
        <div class="beg_time clearfix">
            <span class="f_left">开始时间</span>
            <div class="kinerDatePickerInput f_right" id="kinerDatePickerInput1" title="请选择开始时间" startYear="2017" default-val="2017-12-1">请选择开始时间</div>
        </div>
        <!--结束时间-->
        <div class="end_time clearfix">
            <span class="f_left">结束时间</span>
            <div class="kinerDatePickerInput f_right" id="kinerDatePickerInput2" title="请选择结束时间" startYear="2017" default-val="2017-12-1">请选择结束时间</div>
        </div>
        <div class="work">
            <span>工作地点</span>
            <input type="text" placeholder="请输入工作地点"/>
        </div>
        <div class="sex_require">
            <span>性别要求</span>
           <a href="#middlePopover1">男 <i class="mui-icon mui-icon-arrowdown"></i></a>
            <div id="middlePopover1" class="mui-popover">
                <div class="mui-card">
                    <ul class="mui-table-view mui-table-view-radio sex_choose">
                        <li class="mui-table-view-cell">
                            <a class="mui-navigate-right">
                               男
                            </a>
                        </li>
                        <li class="mui-table-view-cell">
                            <a class="mui-navigate-right">
                              女
                            </a>
                        </li>
                    </ul>
                </div>

            </div>
        </div>
        <div class="pail_require">
            <span>报酬</span>
            <input type="number" placeholder="请输入金额"/>
           <a href="#middlePopover2">元/天<i class="mui-icon mui-icon-arrowdown"></i></a>
            <div id="middlePopover2" class="mui-popover">
                <div class="mui-card">
                    <ul class="mui-table-view mui-table-view-radio pail">
                        <li class="mui-table-view-cell">
                            <a class="mui-navigate-right">

                                元/时
                            </a>
                        </li>
                        <li class="mui-table-view-cell">
                            <a class="mui-navigate-right">
                                元/天
                            </a>
                        </li>
                        <li class="mui-table-view-cell">
                            <a class="mui-navigate-right">
                                元/月
                            </a>
                        </li>
                    </ul>
                </div>

            </div>
        </div>
        <div class="pall_style">
            <span>支付方式</span>
            <div class="style_choose clearfix">
                <span data-type="1">线上支付 <i class="active">√</i></span>
                <span data-type="0">线下支付 <i>√</i></span>
            </div>
        </div>
        <div class="phone_require">
            <span>联系电话</span>
            <input type="number" placeholder="请输入你的电话"/>
        </div>
        <div class="job_des">
            <span>工作描述</span>
            <textarea placeholder="请在这里描述工作内容"></textarea>
        </div>
        <button class="pub">发布</button>
    </div>
</div>
</body>



<script>

    $(function () {
        isUser();
        function render(data){
            console.log(data);
            if(data.code==200){
                if(data.data.auth==false){
                    sweetAlert(
                            "sorry",
                            "你还没有认证通过",
                            "error"
                    ).then(function(){
                                location.href="../mine/mine.html"
                            })
                }
                return false;
                /* if(data.avatar!==null){
                 $(".content>img").css("src",data.avatar);
                 }*/

            }
        }
        myAjax({url:"/user/getCurrentUserMessage",data:{},type:"get",async:false},render)

        FastClick.attach(document.body);
        $('#kinerDatePickerInput1').kinerDatePicker({
            clickMaskHide: true,
            /* showHandler: function (ctx) {
             console.log("显示时间选择器:",ctx);
             },
             hideHandler: function (ctx) {
             console.log("隐藏时间选择器:",ctx);
             },
             changeHandler: function (vals,ctx) {
             console.log("时间改变:",vals,ctx);
             },
             okHandler: function (vals, ctx) {
             console.log("确定选择:",vals,ctx);
             },
             cancelHandler: function (ctx) {
             console.log("取消选择:",ctx);
             }*/
        });

        $('#kinerDatePickerInput2').kinerDatePicker({
            clickMaskHide: true,
            /* showHandler: function (ctx) {
             console.log("显示时间选择器:",ctx);
             },
             hideHandler: function (ctx) {
             console.log("隐藏时间选择器:",ctx);
             },
             changeHandler: function (vals,ctx) {
             console.log("时间改变:",vals,ctx);
             },
             okHandler: function (vals, ctx) {
             console.log("确定选择:",vals,ctx);
             },
             cancelHandler: function (ctx) {
             console.log("取消选择:",ctx);
             }*/
        });
        document.querySelector('.mui-table-view.work_style').addEventListener('selected',function(e1){
            window.event? window.event.cancelBubble = true : e.stopPropagation();
            console.log("工作年限为：" + e1.detail.el.innerText);
            document.querySelector(".work_type>a").innerText= e1.detail.el.innerText;
            document.querySelector("#middlePopover").style.display="none";
            document.querySelector(".mui-backdrop").style.display="none";
            /* alert(1);*/
        });
        /*性别选择*/
        document.querySelector('.mui-table-view.sex_choose').addEventListener('selected',function(e1){
            window.event? window.event.cancelBubble = true : e.stopPropagation();
            console.log("性别为：" + e1.detail.el.innerText);
            document.querySelector(".sex_require>a").innerText= e1.detail.el.innerText;
            document.querySelector("#middlePopover1").style.display="none";
            document.querySelector(".mui-backdrop").style.display="none";
            /* alert(1);*/
        });
        /*报酬 */
        document.querySelector('.mui-table-view.pail').addEventListener('selected',function(e1){
            window.event? window.event.cancelBubble = true : e.stopPropagation();
            console.log(e1.detail.el);
            console.log("工资为：" + e1.detail.el.innerText);
            document.querySelector(".pail_require>a").innerText= e1.detail.el.innerText;
            document.querySelector(".pail_require>a").style.textAlign="left";
            document.querySelector("#middlePopover2").style.display="none";
            document.querySelector(".mui-backdrop").style.display="none";
            /* alert(1);*/
        });
        /*支付方式的选择*/
        var payMethod=1;
        $(".style_choose span").click(function () {
            $(this).children().addClass("active");
            $(this).siblings().children().removeClass("active");
             payMethod=$(this).data("type");
            console.log(payMethod);
        });
        $(".pub").click(function () {
            // 获取报酬
            var pailMoney=$(".pail_require>input").val()+$(".pail_require>a").text();
            console.log(pailMoney);
            //需要的人数
            var number =$(".need>input").val();
            var workType=$(".work_type>a").text();
            if(workType=="请选择"){
                sweetAlert(
                        "sorry",
                        "请您选择工作类型",
                        "error"
                );
                return false;
            }
            if(number=="请选择"){
                sweetAlert(
                        "sorry",
                        "请您输入需要的人数",
                        "error"
                );
                return false;
            }
        var workTime=$(".time>input").val();
            if(workTime==""){
                sweetAlert(
                        "sorry",
                        "请您描述工作时段",
                        "error"
                );
                return false;
            }
                var startTime=$("#kinerDatePickerInput1").text();
                var endTime=$("#kinerDatePickerInput2").text();
            if(startTime=="请选择开始时间"||endTime=="请选择结束时间"){
                sweetAlert(
                        "sorry",
                        "请选择时间",
                        "error"
                );
                return false;
            }else{
                endTime=new Date(endTime.replace(/-/g,"/")).getTime();
                startTime=new Date(startTime.replace(/-/g,"/")).getTime();
            }

            var address=$(".work>input").val();
            if(address==""){
                sweetAlert(
                        "sorry",
                        "请您填写工作地点",
                        "error"
                );
                return false;
            }
            var sex=$(".sex_require>a").text();
            var price=$(".pail_require>input").val();
            if(price==""){
                sweetAlert(
                        "sorry",
                        "请您填写金额",
                        "error"
                );
                return false;
            }

            var priceType=price+$(".pail_require>a").text();
            //电话号码：
            let mobilePhone=$(".phone_require>input").val().trim();
            //验证手机号
            checkTelNum(mobilePhone);

            function checkTelNum(telNum){
                if(!/^1[0-9]{10}$/.test(telNum)){
                    return false;
                }
                return true;
            }
            // 支付方式
            var introduce=$(".job_des>textarea").val();
            $.ajax({
                type:"post",
                url:baseUrl+"/job/pushJob",
                dataType:"json",
                xhrFields: {
                    withCredentials: true
                },
                data:{
                    address:address,
                    endTime:endTime,
                    introduce:introduce,
                    mobilePhone:mobilePhone,
                    number:number,
                    priceType:priceType,
                    sex:sex,
                    startTime:startTime,
                    workTime:workTime,
                    workType:workType,
                    payMethod:payMethod
                },
                beforeSend: function (data) {
                    //console.log(data);
                },
                success: function (data) {
                    console.log(data);
                    if(data.code==200){
                        sweetAlert(
                                "恭喜您",
                                data.msg,
                                "success"
                        ).then(function () {
                                    location.href='../index/index.html';
                                })
                    }
                },
                error: function (msg) {
                    sweetAlert(
                            "sorry",
                            msg.msg,
                            "error"
                    )
                }
            })

        })
    })
</script>
</html>